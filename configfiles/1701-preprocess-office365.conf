# SOF-ELKÂ® Configuration File
# (C)2020 Lewes Technology Consulting, LLC
#
# This file contains preprocessors for Microsoft Office 365 logs

filter {
  if [type] == "office365" {
    # Need to drop that pesky second header
    if [message] =~ /^#/ {
      drop {}

    } else if [message] == "CreationDate,UserIds,Operations,AuditData" or 
              [message] =~ "^#" or 
              [message] == "PSComputerName,RunspaceId,PSShowComputerName,RecordType,CreationDate,UserIds,Operations,AuditData,ResultIndex,ResultCount,Identity,IsValid,ObjectState" or
              [message] == '"PSComputerName","RunspaceId","PSShowComputerName","RecordType","CreationDate","UserIds","Operations","AuditData","ResultIndex","ResultCount","Identity","IsValid","ObjectState"' {
      drop {}
    }

    # lowercase all true/false values so downstream picks them up as booleans
    mutate {
      gsub => [
        "message", '(?i)""true""', 'true',
        "message", '(?i)""false""', 'false',
        "message", '(?i)"true"', '"true"',
        "message", '(?i)"false"', '"false"'
      ]
    }
  }
}

